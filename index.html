<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLSound - Soundboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sora:ital,wght@1,800&display=swap" rel="stylesheet">
    
    <style>
        body {
            background-color: #1d1d1b;
            color: white;
            font-family: Arial, sans-serif;
        }
        
        .main-container {
            min-height: 100vh;
            padding: 1.85vh 4vw 3.43vh 4vw;
        }
        
        .main-title {
            font-size: clamp(36px, 4vw, 60px);
            font-weight: bold;
            line-height: 1;
            margin-bottom: 2rem;
        }
        
        .main-title .subtitle {
            font-family: 'Sora', Arial, sans-serif;
            font-weight: 800;
            font-style: italic;
            color: #FFC107;
        }
        
        .numpad {
            background: #2d2d2d;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-width: clamp(250px, 50vw, 40vh);
        }
        
        .numpad-key {
            background-color: #1d1d1b;
            border: none;
            border-radius: 0.8rem;
            color: white;
            font-size: clamp(18px, 2vw, 36px);
            font-weight: bold;
            aspect-ratio: 1;
            transition: all 0.2s;
            margin: 0.25rem;
        }
        
        .numpad-key:hover {
            background-color: #e8f5e8;
            color: #333;
        }
        
        .numpad-key:active {
            background-color: #d4e8d4;
            transform: scale(0.95);
        }
        
        .numpad-key.btn-danger {
            background-color: #ff6b6b;
        }
        
        .numpad-key.btn-danger:hover {
            background-color: #ff5252;
        }
        
        .numpad-key.btn-success {
            background-color: #4CAF50;
        }
        
        .numpad-key.btn-success:hover {
            background-color: #45a049;
        }
        
        .numpad-key.btn-warning {
            background-color: #FFC107;
            color: #333;
        }
        
        .numpad-key.btn-warning:hover {
            background-color: #FFB300;
        }
        
        .info-image {
            border-radius: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .info-text {
            background-color: #2d2d2d;
            border-radius: 0.8rem;
            border: none;
            color: white;
            max-height: 30vh;
            overflow-y: auto;
        }
        
        .info-text::-webkit-scrollbar {
            width: 0.5rem;
        }
        
        .info-text::-webkit-scrollbar-track {
            background: #464646;
            border-radius: 0.25rem;
        }
        
        .info-text::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 0.25rem;
        }
        
        .info-text::-webkit-scrollbar-thumb:hover {
            background: #777;
        }
        
        .info-text {
            scrollbar-width: thin;
            scrollbar-color: #666 #464646;
        }
        
        .info-title {
            font-size: clamp(16px, 2.5vw, 36px);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
            border-color: #545b62;
        }
        
        #numberInput {
            max-width: clamp(250px, 50vw, 40vh);
            text-align: center;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
        
        /* Spinner-Buttons entfernen */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        /* Desktop Optimierungen */
        @media (min-width: 1200px) {
            .content-wrapper {
                height: 85vh;
            }
        }
        
        /* Mobile Anpassungen */
        @media (max-width: 768px) {
            .main-container {
                padding: 2vh 3vw;
            }
            
            .numpad-key {
                font-size: 1.5rem;
                min-height: 60px;
            }
            
            .info-text {
                max-height: 40vh;
            }
        }
        
        /* Spezifische Anpassungen für große Displays */
        @media (min-width: 1900px) and (min-height: 1100px) {
            .main-container {
                padding: calc(7mm * 0.75) calc(20mm * 0.75) calc(13mm * 0.75) calc(20mm * 0.75);
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid main-container" style="padding-top: 7vh;">
        <!-- Main Content Row -->
        <div class="row content-wrapper g-4">
            
            <!-- Numpad Column -->
            <div class="col-lg-6 col-12">
                <div class="col-12 text-center">
                <h1 class="main-title">
                    <b>BRUCHLAST</b><span class="subtitle">sound</span>
                </h1>
            </div>
            <div class="d-flex flex-column">
                <!-- Input Field -->
                <div class="mb-4">
                    <input type="number" 
                            id="numberInput" 
                            class="form-control form-control-lg" 
                            placeholder="Nummer hier eingeben..." 
                            readonly 
                            maxlength="3">
                </div>
                
                <!-- Numpad -->
                <div class="numpad mx-auto">
                    <div class="row g-2">
                        <div class="col-4">
                            <button class="btn numpad-key w-100" onclick="inputNumber('7')">7</button>
                        </div>
                        <div class="col-4">
                            <button class="btn numpad-key w-100" onclick="inputNumber('8')">8</button>
                        </div>
                        <div class="col-4">
                            <button class="btn numpad-key w-100" onclick="inputNumber('9')">9</button>
                        </div>
                        <div class="col-4">
                            <button class="btn numpad-key w-100" onclick="inputNumber('4')">4</button>
                        </div>
                        <div class="col-4">
                            <button class="btn numpad-key w-100" onclick="inputNumber('5')">5</button>
                        </div>
                        <div class="col-4">
                            <button class="btn numpad-key w-100" onclick="inputNumber('6')">6</button>
                        </div>
                        <div class="col-4">
                            <button class="btn numpad-key w-100" onclick="inputNumber('1')">1</button>
                        </div>
                        <div class="col-4">
                            <button class="btn numpad-key w-100" onclick="inputNumber('2')">2</button>
                        </div>
                        <div class="col-4">
                            <button class="btn numpad-key w-100" onclick="inputNumber('3')">3</button>
                        </div>
                        <div class="col-4">
                            <button class="btn numpad-key btn-danger w-100" onclick="backspace()">⌫</button>
                        </div>
                        <div class="col-4">
                            <button class="btn numpad-key w-100" onclick="inputNumber('0')">0</button>
                        </div>
                        <div class="col-4">
                            <button class="btn numpad-key btn-success w-100" id="playStopButton" onclick="togglePlayStop()">▶</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            
            <!-- Info Column -->
            <div class="col-lg-6 col-12">
                <div class="d-flex flex-column h-100">
                    <!-- Image -->
                    <div class="mb-3">
                        <img id="infoImage" 
                             src="files/standard.jpg" 
                             alt="BLSound Info Bild" 
                             class="img-fluid info-image w-100"
                             style="height: 25vh; object-fit: cover;">
                    </div>
                    
                    <!-- Header with Back Button and Title -->
                    <div class="d-flex align-items-center justify-content-center mb-3 gap-3">
                        <button id="backButton" 
                                class="btn btn-warning" 
                                onclick="resetToDefault()" 
                                style="display: none;">
                            ← 
                        </button>
                        <h2 id="infoTitle" class="info-title text-center m-0">Informationen</h2>
                    </div>
                    
                    <!-- Audio Players -->
                    <div class="mb-3">
                        <audio id="audioPlayer" class="w-100" controls style="display: none;">
                            Ihr Browser unterstützt das Audio-Element nicht.
                        </audio>

                        <audio id="introAudio" class="w-100" controls>
                            <source src="files/BLC_introaudio.mp3" type="audio/mpeg">
                            Ihr Browser unterstützt das Audioelement nicht.
                        </audio>
                    </div>
                    
                    <!-- Info Text -->
                    <div id="infoText" class="info-text p-3 flex-grow-1">
                        <p>Lade Informationen...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Button Row -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="d-flex flex-wrap justify-content-center gap-2">
                    <button class="btn btn-warning" onclick="window.open('https://www.th-luebeck.de/bruchlast/', '_blank')">
                        Zum Bruchlast-Chart
                    </button>
                    <span style="width:10rem;display:inline-block;"></span>
                    <button class="btn btn-secondary" onclick="setLanguage('de')">🇩🇪 Deutsch</button>
                    <button class="btn btn-secondary" onclick="setLanguage('en')">🇬🇧 English</button>
                    <button class="btn btn-secondary" onclick="setLanguage('zh')">🇨🇳 中文</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const numberInput = document.getElementById('numberInput');
        const audioPlayer = document.getElementById('audioPlayer');
        const introAudio = document.getElementById('introAudio');
        const infoImage = document.getElementById('infoImage');
        const infoText = document.getElementById('infoText');
        const infoTitle = document.getElementById('infoTitle');
        const backButton = document.getElementById('backButton');
        const playStopButton = document.getElementById('playStopButton');
        
        // Spielstatus verfolgen
        let isPlaying = false;
        let currentAudioUrl = null;
        
        // Ursprungswerte für Reset - werden beim Laden gesetzt
        let defaultTitle = "Informationen";
        let defaultImage = "files/standard.jpg";
        let defaultText = '<p>Lade Informationen...</p>';
        
        // Unterstützte Bildformate
        const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'];
        
        // Aktuelle Sprache verfolgen
        let currentLanguage = 'de';
        
        // Sprache setzen
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Alle Sprach-Buttons zurücksetzen (sowohl btn-secondary als auch btn-success)
            document.querySelectorAll('button[onclick*="setLanguage"]').forEach(btn => {
                btn.classList.remove('btn-success');
                btn.classList.add('btn-secondary');
            });
            
            // Aktiven Sprach-Button hervorheben
            const activeButton = document.querySelector(`[onclick="setLanguage('${lang}')"]`);
            if (activeButton) {
                activeButton.classList.remove('btn-secondary');
                activeButton.classList.add('btn-success');
            }
            
            // Standard-Inhalte in neuer Sprache laden
            loadDefaultContent();
            
            console.log(`Sprache gewechselt zu: ${lang}`);
        }
        
        // Dateinamen mit Sprachsuffix generieren
        function getLocalizedFilename(baseName, extension) {
            if (currentLanguage === 'de') {
                return `${baseName}.${extension}`;
            }
            return `${baseName}_${currentLanguage}.${extension}`;
        }
        
        // Fallback-Inhalte je nach Sprache
        function setFallbackContent() {
            const fallbackTexts = {
                'de': {
                    title: 'Wie funktioniert das Soundboard?',
                    content: `
                        <p>Willkommen bei BLSound! Dieses Kiosk-System ermöglicht es Ihnen, durch einfache Eingabe einer dreistelligen Nummer Audioinhalte abzuspielen.</p>
                        <p><strong>So funktioniert's:</strong></p>
                        <ul>
                            <li>Geben Sie eine Nummer zwischen 001 und 999 ein</li>
                            <li>Verwenden Sie das Numpad für die Eingabe</li>
                            <li>Drücken Sie den Play-Button (▶) zum Abspielen</li>
                            <li>Mit dem Backspace (⌫) können Sie Zahlen löschen</li>
                        </ul>
                        <p>Das System ist optimiert für Touch-Bedienung und bietet eine intuitive Benutzeroberfläche für alle Altersgruppen.</p>
                    `
                },
                'en': {
                    title: 'How does the Soundboard work?',
                    content: `
                        <p>Welcome to BLSound! This kiosk system allows you to play audio content by simply entering a three-digit number.</p>
                        <p><strong>How it works:</strong></p>
                        <ul>
                            <li>Enter a number between 001 and 999</li>
                            <li>Use the numpad for input</li>
                            <li>Press the Play button (▶) to start playback</li>
                            <li>Use Backspace (⌫) to delete numbers</li>
                        </ul>
                        <p>The system is optimized for touch operation and provides an intuitive user interface for all age groups.</p>
                    `
                },
                'zh': {
                    title: '声音板如何工作？',
                    content: `
                        <p>欢迎使用BLSound！这个自助服务系统允许您通过简单输入三位数字来播放音频内容。</p>
                        <p><strong>使用方法：</strong></p>
                        <ul>
                            <li>输入001到999之间的数字</li>
                            <li>使用数字键盘输入</li>
                            <li>按播放按钮（▶）开始播放</li>
                            <li>使用退格键（⌫）删除数字</li>
                        </ul>
                        <p>该系统针对触摸操作进行了优化，为所有年龄组提供直观的用户界面。</p>
                    `
                }
            };
            
            const content = fallbackTexts[currentLanguage] || fallbackTexts['de'];
            defaultTitle = content.title;
            defaultText = content.content;
            
            infoTitle.textContent = defaultTitle;
            infoText.innerHTML = defaultText;
        }
        
        // Standard-Inhalte laden
        async function loadDefaultContent() {
            try {
                const howToFile = getLocalizedFilename('howTo', 'html');
                const response = await fetch(`files/${howToFile}`);
                
                if (response.ok) {
                    const content = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(content, 'text/html');
                    
                    const h2Element = doc.querySelector('h2');
                    if (h2Element) {
                        defaultTitle = h2Element.textContent;
                        infoTitle.textContent = defaultTitle;
                        h2Element.remove();
                    }
                    
                    defaultText = doc.body.innerHTML;
                    infoText.innerHTML = defaultText;
                } else {
                    setFallbackContent();
                }
                
                // Standard-Bild mit Sprachsuffix
                const standardImage = getLocalizedFilename('standard', 'jpg');
                if (await fileExists(`files/${standardImage}`)) {
                    defaultImage = `files/${standardImage}`;
                    infoImage.src = defaultImage;
                } else {
                    defaultImage = 'files/standard.jpg';
                    infoImage.src = defaultImage;
                }
                
            } catch (error) {
                console.error('Fehler beim Laden der Standard-Inhalte:', error);
                setFallbackContent();
            }
        }
        
        // HTML-Datei laden
        async function loadHtmlFile(number) {
            try {
                const htmlFile = getLocalizedFilename(number, 'html');
                let response = await fetch(`files/${htmlFile}`);
                
                if (!response.ok) {
                    const htmlFileUpper = getLocalizedFilename(number, 'HTML');
                    response = await fetch(`files/${htmlFileUpper}`);
                }
                
                if (response.ok) {
                    const content = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(content, 'text/html');
                    
                    const h2Element = doc.querySelector('h2');
                    let title = null;
                    if (h2Element) {
                        title = h2Element.textContent;
                        h2Element.remove();
                    }
                    
                    const htmlContent = doc.body.innerHTML;
                    
                    return {
                        title: title,
                        content: htmlContent
                    };
                }
            } catch (error) {
                console.log('HTML-Datei nicht gefunden:', error);
            }
            return null;
        }
        
        // Bild suchen
        async function findImage(number) {
            for (const ext of imageExtensions) {
                const localizedUrl = `files/${getLocalizedFilename(number, ext)}`;
                if (await fileExists(localizedUrl)) {
                    return localizedUrl;
                }
                
                const localizedUrlUpper = `files/${getLocalizedFilename(number, ext.toUpperCase())}`;
                if (await fileExists(localizedUrlUpper)) {
                    return localizedUrlUpper;
                }
                
                // Fallback auf deutsche Version
                if (currentLanguage !== 'de') {
                    const url = `files/${number}.${ext}`;
                    if (await fileExists(url)) {
                        return url;
                    }
                    const urlUpper = `files/${number}.${ext.toUpperCase()}`;
                    if (await fileExists(urlUpper)) {
                        return urlUpper;
                    }
                }
            }
            return null;
        }
        
        // Play Button Funktion
        async function playNumber() {
            const number = numberInput.value;
            if (!number) {
                console.log('Bitte geben Sie eine Nummer ein!');
                return;
            }
            
            const paddedNumber = number.padStart(3, '0');
            
            try {
                let audioUrl = `./files/${getLocalizedFilename(paddedNumber, 'mp3')}`;
                let audioExists = await fileExists(audioUrl);
                
                if (!audioExists) {
                    audioUrl = `./files/${getLocalizedFilename(paddedNumber, 'MP3')}`;
                    audioExists = await fileExists(audioUrl);
                }
                
                // Fallback auf deutsche Version
                if (!audioExists && currentLanguage !== 'de') {
                    audioUrl = `./files/${paddedNumber}.mp3`;
                    audioExists = await fileExists(audioUrl);
                    
                    if (!audioExists) {
                        audioUrl = `./files/${paddedNumber}.MP3`;
                        audioExists = await fileExists(audioUrl);
                    }
                }
                
                if (audioExists) {
                    currentAudioUrl = audioUrl;
                    audioPlayer.src = audioUrl;
                    audioPlayer.style.display = 'block';
                    introAudio.style.display = 'none';
                    
                    try {
                        await audioPlayer.play();
                        isPlaying = true;
                        
                        playStopButton.textContent = '⏹';
                        playStopButton.classList.remove('btn-success');
                        playStopButton.classList.add('btn-warning');
                        
                        console.log(`Spiele Nummer ${paddedNumber} ab`);
                    } catch (playError) {
                        console.error('Fehler beim Abspielen:', playError);
                        return;
                    }
                    
                    const imageUrl = await findImage(paddedNumber);
                    if (imageUrl) {
                        infoImage.src = imageUrl;
                        infoImage.alt = `Bild für Nummer ${paddedNumber}`;
                    } else {
                        infoImage.src = 'files/sound.svg';
                        infoImage.alt = `Audio-Symbol für Nummer ${paddedNumber}`;
                        console.log(`Kein Bild für Nummer ${paddedNumber} gefunden, verwende sound.svg`);
                    }
                    
                    const htmlData = await loadHtmlFile(paddedNumber);
                    if (htmlData) {
                        if (htmlData.title) {
                            infoTitle.textContent = htmlData.title;
                        } else {
                            infoTitle.textContent = `Nummer ${paddedNumber}`;
                        }
                        
                        infoText.innerHTML = htmlData.content;
                    } else {
                        infoText.innerHTML = '';
                        infoTitle.textContent = `Nummer ${paddedNumber}`;
                        console.log(`Keine HTML-Datei für Nummer ${paddedNumber} gefunden`);
                        infoText.style.display = 'none';
                    }
                    
                } else {
                    console.log(`Keine Audio-Datei für Nummer ${paddedNumber} gefunden`);
                    
                    const nosoundSvg = getLocalizedFilename('nosound', 'svg');
                    if (await fileExists(`files/${nosoundSvg}`)) {
                        infoImage.src = `files/${nosoundSvg}`;
                    } else {
                        infoImage.src = 'files/nosound.svg';
                    }
                    infoImage.alt = `Keine Audio-Datei für Nummer ${paddedNumber}`;
                    
                    const nosoundData = await loadHtmlFile('nosound');
                    if (nosoundData) {
                        if (nosoundData.title) {
                            infoTitle.textContent = nosoundData.title;
                        } else {
                            const noAudioTexts = {
                                'de': `Nummer ${paddedNumber} - Keine Audiodatei`,
                                'en': `Number ${paddedNumber} - No audio file`,
                                'zh': `编号 ${paddedNumber} - 没有音频文件`
                            };
                            infoTitle.textContent = noAudioTexts[currentLanguage] || noAudioTexts['de'];
                        }
                        infoText.innerHTML = nosoundData.content;
                    } else {
                        const noAudioTexts = {
                            'de': {
                                title: `Nummer ${paddedNumber} - Keine Audiodatei`,
                                content: '<p>Für diese Nummer ist keine Audiodatei verfügbar.</p>'
                            },
                            'en': {
                                title: `Number ${paddedNumber} - No audio file`,
                                content: '<p>No audio file is available for this number.</p>'
                            },
                            'zh': {
                                title: `编号 ${paddedNumber} - 没有音频文件`,
                                content: '<p>此编号没有可用的音频文件。</p>'
                            }
                        };
                        
                        const content = noAudioTexts[currentLanguage] || noAudioTexts['de'];
                        infoTitle.textContent = content.title;
                        infoText.innerHTML = content.content;
                    }
                }
                
                backButton.style.display = 'block';
                
            } catch (error) {
                console.error('Fehler beim Laden der Dateien:', error);
            }
            
            setTimeout(() => {
                numberInput.value = '';
            }, 1000);
        }
        
        // Audio stoppen
        function stopAudio() {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            audioPlayer.style.display = 'none';
            introAudio.style.display = 'block';
            isPlaying = false;
            
            playStopButton.textContent = '▶';
            playStopButton.classList.remove('btn-warning');
            playStopButton.classList.add('btn-success');
            
            resetToDefault();
            
            console.log('Wiedergabe gestoppt');
        }
        
        // Audio-Player Event Listener
        audioPlayer.addEventListener('ended', function() {
            isPlaying = false;
            playStopButton.textContent = '▶';
            playStopButton.classList.remove('btn-warning');
            playStopButton.classList.add('btn-success');
            console.log('Wiedergabe beendet');
        });
        
        audioPlayer.addEventListener('error', function() {
            isPlaying = false;
            playStopButton.textContent = '▶';
            playStopButton.classList.remove('btn-warning');
            playStopButton.classList.add('btn-success');
            console.error('Fehler beim Laden der Audio-Datei');
        });
        
        // Beim Laden der Seite
        document.addEventListener('DOMContentLoaded', function() {
            setLanguage('de');
            numberInput.focus();
        });
        
        // Zurück zum Standard-Content
        function resetToDefault() {
            infoTitle.textContent = defaultTitle;
            infoImage.src = defaultImage;
            infoText.innerHTML = defaultText;
            audioPlayer.style.display = 'none';
            introAudio.style.display = 'block';
            backButton.style.display = 'none';
            infoText.style.display = 'block';
            
            if (isPlaying) {
                audioPlayer.pause();
                isPlaying = false;
                playStopButton.textContent = '▶';
                playStopButton.classList.remove('btn-warning');
                playStopButton.classList.add('btn-success');
            }
        }
        
        // Zahl eingeben
        function inputNumber(digit) {
            const currentValue = numberInput.value;
            
            if (currentValue.length < 3) {
                numberInput.value = currentValue + digit;
                numberInput.dispatchEvent(new Event('input', { bubbles: true }));
            }
        }
        
        // Letzte Ziffer löschen
        function backspace() {
            const currentValue = numberInput.value;
            numberInput.value = currentValue.slice(0, -1);
            numberInput.dispatchEvent(new Event('input', { bubbles: true }));
        }
        
        // Datei existiert prüfen
        async function fileExists(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                return response.ok;
            } catch (error) {
                return false;
            }
        }
        
        // Play/Stop Toggle
        function togglePlayStop() {
            if (isPlaying) {
                stopAudio();
            } else {
                playNumber();
            }
        }
    </script>
</body>
</html>