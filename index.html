<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLSound - Soundboard</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1d1d1b;
            color: white;
            height: 100vh;
            overflow: hidden;
            /* Margins für 2000x1200px Display: 7mm oben, 20mm Seiten, 13mm unten */
            padding: 1.85vh 4vw 3.43vh 4vw;
            box-sizing: border-box;
        }
        
        .main-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3vw;
            flex: 1;
            min-height: 0;
            max-height: 90vh;
        }
        
        .container, .info-container {
            background: none;
            padding: 2vh 2vw;
            border-radius: 0vw;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            
        }

        .button-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .input-group {
            margin: 2vh 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        label {
            display: block;
            margin-bottom: 0.5vh;
            font-weight: bold;
            text-align: center;
        }
        
        input[type="number"] {
            width: 80%;
            max-width: 25vw;
            padding: 1.5vh 2vw;
            font-size: clamp(18px, 2vw, 32px);
            border: 2px solid #ddd;
            border-radius: 0.5vw;
            box-sizing: border-box;
            text-align: center;
            margin: 0 auto;
            display: block;
        }
        
        /* Spinner-Buttons für number input entfernen */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    
        
        input[type="number"]:focus {
            border-color: #4CAF50;
            outline: none;
        }
        
        /* Titel */
        .main-title {
            text-align: center;
            font-size: clamp(24px, 4vw, 60px);
            line-height: 1;
            margin-bottom: 2vh;
            font-weight: bold;
        }
        
        .main-title .subtitle {
            font-family: 'Sora', Arial, sans-serif;
            font-weight: 800;
            font-style: italic;
            color: #FFC107;
        }
        
        /* Numpad Styling */
        .numpad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1vw;
            min-width: 20vw;
            max-height: 70vh;
            margin: 3vh auto;
            padding: 2vh 2vw;
            background: #2d2d2d;
            border-radius: 1vw;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .numpad-key {
            background-color: #1d1d1b;
            border: none;
            border-radius: 0.8vw;
            padding: 1vh 1vw;
            font-size: clamp(18px, 2vw, 36px);
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1;
            min-height: 1vh;
        }
        
        .numpad-key:hover {
            background-color: #e8f5e8;
            color: #333;
        }
        
        .numpad-key:active {
            background-color: #d4e8d4;
            transform: scale(0.95);
        }
        
        .numpad-key.backspace {
            background-color: #ff6b6b;
            color: white;
        }
        
        .numpad-key.backspace:hover {
            background-color: #ff5252;
        }
        
        .numpad-key.play {
            background-color: #4CAF50;
            color: white;
        }
        
        .numpad-key.play:hover {
            background-color: #45a049;
        }
        
        /* Stop-Button Styling */
        .numpad-key.stop {
            background-color: #FFC107;
            color: #333;
        }
        
        .numpad-key.stop:hover {
            background-color: #FFB300;
        }
        
        /* Info Container Styling */
        .info-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2vw;
            margin-bottom: 2vh;
        }
        
        .info-container h2 {
            color: white;
            margin: 0;
            text-align: center;
            font-size: clamp(6px, 2.5vw, 36px);
            max-width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        
        .back-button {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 1vh 2vw;
            border-radius: 0.5vw;
            cursor: pointer;
            font-size: clamp(12px, 1.2vw, 18px);
            transition: all 0.2s;
        }
        .info-button {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 2vh 2vw;
            border-radius: 0.5vw;
            cursor: pointer;
            font-size: clamp(12px, 1.2vw, 18px);
            transition: all 0.2s;
            height: 6vh;
            min-width: 10vw;
            margin: 0 1vw;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }
        
        .back-button:hover {
            background-color: #5a6268;
        }
        
        .info-image {
            width: 100%;
            height: 25vh;
            object-fit: cover;
            border-radius: 1vw;
            margin: 2vh auto;
            display: block;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .info-text {
            font-size: clamp(14px, 1.4vw, 20px);
            line-height: 1.6;
            color: white;
            text-align: justify;
            margin-top: 2vh;
            flex: 1;
            overflow-y: auto;
            padding: 2vh 2vw;
            background-color: #2d2d2d;
            border-radius: 0.8vw;
            border: none;
            min-height: 15vh;
            max-height: 30vh;
        }
        
        /* Scrollbar Styling für Webkit-Browser */
        .info-text::-webkit-scrollbar {
            width: 0.5vw;
        }
        
        .info-text::-webkit-scrollbar-track {
            background: #464646;
            border-radius: 0.25vw;
        }
        
        .info-text::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 0.25vw;
        }
        
        .info-text::-webkit-scrollbar-thumb:hover {
            background: #777;
        }
        
        /* Scrollbar für Firefox */
        .info-text {
            scrollbar-width: thin;
            scrollbar-color: #666 #464646;
        }
        
        /* Audio Player Styling */
        .audio-player {
            margin: 2vh auto;
            width: 100%;
            height: 5vh;
            display: none;
        }
        
        /* Desktop: Kein Scrolling */
        @media (min-width: 1201px) {
            body {
                overflow: hidden;
            }
            
            .main-container {
                height: 100vh;
                overflow: hidden;
            }
        }
        
        /* Tablets: Zwei-Spalten Layout mit begrenzter Höhe */
        @media (max-width: 1200px) and (min-width: 769px) {
            body {
                overflow: hidden;
            }
            
            .content-wrapper {
                grid-template-columns: 1fr;
                gap: 3vh;
                overflow-y: auto;
            }
            
            body {
                padding: 2vh 3vw;
            }
            
            .info-header {
                flex-direction: column;
                gap: 1vh;
            }
            
            .numpad {
                max-width: 60vw;
            }
            
            .info-image {
                height: 30vh;
            }
            
            .info-text {
                min-height: 20vh;
                max-height: 30vh;
            }
        }
        
        /* Mobile: Scrollbares Ein-Spalten Layout */
        @media (max-width: 768px) {
            body {
                overflow-y: auto;
                overflow-x: hidden;
                height: auto;
                min-height: 100vh;
                padding: 2vh 3vw;
            }
            
            .main-container {
                height: auto;
                min-height: calc(100vh - 4vh);
            }
            
            .content-wrapper {
                grid-template-columns: 1fr;
                gap: 4vh;
            }
            
            .container, .info-container {
                overflow: visible;
            }
            
            .numpad {
                max-width: 90vw;
                gap: 2vw;
                margin: 2vh auto;
            }
            
            .numpad-key {
                min-height: 12vh;
                padding: 2vh 2vw;
            }
            
            .info-image {
                height: 30vh;
            }
            
            .info-text {
                min-height: 20vh;
                max-height: 40vh;
            }
            
            /* Mobile Scrollbar */
            .info-text::-webkit-scrollbar {
                width: 8px;
            }
        }
        
        /* Spezifische Anpassungen für 2000x1200px Display */
        @media (min-width: 1900px) and (min-height: 1100px) {
            body {
                /* 7mm = ca. 26px bei 96dpi, 13mm = ca. 49px */
                padding: calc(7mm * 0.75) calc(20mm * 0.75) calc(13mm * 0.75) calc(20mm * 0.75);
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="content-wrapper">
            <!-- Numpad Container -->
            <div class="container">
                <h1 class="main-title">
                    <b>BRUCHLAST</b><span class="subtitle">sound</span>
                </h1>
                
                <div class="input-group">
                    <input type="number" id="numberInput" placeholder="Nummer hier eingeben..." readonly maxlength="3">
                </div>
                
                <!-- Eingebettetes Numpad -->
                <div class="numpad">
                    <button class="numpad-key" onclick="inputNumber('7')">7</button>
                    <button class="numpad-key" onclick="inputNumber('8')">8</button>
                    <button class="numpad-key" onclick="inputNumber('9')">9</button>
                    <button class="numpad-key" onclick="inputNumber('4')">4</button>
                    <button class="numpad-key" onclick="inputNumber('5')">5</button>
                    <button class="numpad-key" onclick="inputNumber('6')">6</button>
                    <button class="numpad-key" onclick="inputNumber('1')">1</button>
                    <button class="numpad-key" onclick="inputNumber('2')">2</button>
                    <button class="numpad-key" onclick="inputNumber('3')">3</button>
                    <button class="numpad-key backspace" onclick="backspace()">⌫</button>
                    <button class="numpad-key" onclick="inputNumber('0')">0</button>
                    <button class="numpad-key play" id="playStopButton" onclick="togglePlayStop()">▶</button>
                </div>
            </div>
            
            <!-- Info Container -->
            <div class="info-container">
                <img id="infoImage" 
                     src="files/standard.jpg" 
                     alt="BLSound Info Bild" 
                     class="info-image">
                
                <div class="info-header">
                    <button id="backButton" class="back-button" onclick="resetToDefault()" style="display: none;">← Zurück</button>
                    <h2 id="infoTitle">Informationen</h2>
                </div>
                
                <!-- Audio Player unter dem Bild -->
                <audio id="audioPlayer" class="audio-player" controls>
                    Ihr Browser unterstützt das Audio-Element nicht.
                </audio>

                <audio id="introAudio" controls>
                    <source src="files/BLC_introaudio.mp3" type="audio/mpeg">
                    Ihr Browser unterstützt das Audioelement nicht.
                </audio>
                
                <div id="infoText" class="info-text">
                    <p>Lade Informationen...</p>
                </div>
            </div>
        </div>
        <div class="button-container">
            <button class="info-button" onclick="window.open('https://www.th-luebeck.de/bruchlast/', '_blank')">Bruchlast-Chart</button>
            <button class="info-button" onclick="setLanguage('de')">🇩🇪 Deutsch</button>
            <button class="info-button" onclick="setLanguage('en')">🇬🇧 English</button>
            <button class="info-button" onclick="setLanguage('zh')">🇨🇳 中文</button>
        </div>
    </div>

    <script>
        const numberInput = document.getElementById('numberInput');
        const audioPlayer = document.getElementById('audioPlayer');
        const introAudio = document.getElementById('introAudio');
        const infoImage = document.getElementById('infoImage');
        const infoText = document.getElementById('infoText');
        const infoTitle = document.getElementById('infoTitle');
        const backButton = document.getElementById('backButton');
        const playStopButton = document.getElementById('playStopButton');
        
        // Spielstatus verfolgen
        let isPlaying = false;
        let currentAudioUrl = null;
        
        // Ursprungswerte für Reset - werden beim Laden gesetzt
        let defaultTitle = "Informationen";
        let defaultImage = "files/standard.jpg";
        let defaultText = '<p>Lade Informationen...</p>';
        
        // Unterstützte Bildformate
        const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'];
        
        // Aktuelle Sprache verfolgen
        let currentLanguage = 'de';
        
        // Sprache setzen
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Visuelle Anzeige der aktiven Sprache
            document.querySelectorAll('.info-button').forEach(btn => {
                btn.style.backgroundColor = '#6c757d';
                btn.style.color = 'white';
            });
            
            // Aktiven Sprach-Button hervorheben
            const activeButton = document.querySelector(`[onclick="setLanguage('${lang}')"]`);
            if (activeButton) {
                activeButton.style.backgroundColor = '#4CAF50';
                activeButton.style.color = 'white';
            }
            
            // Standard-Inhalte in neuer Sprache laden
            loadDefaultContent();
            
            console.log(`Sprache gewechselt zu: ${lang}`);
        }
        
        // Dateinamen mit Sprachsuffix generieren
        function getLocalizedFilename(baseName, extension) {
            if (currentLanguage === 'de') {
                return `${baseName}.${extension}`;
            }
            return `${baseName}_${currentLanguage}.${extension}`;
        }
        
        // Standard-Inhalte laden (erweitert für Mehrsprachigkeit)
        async function loadDefaultContent() {
            try {
                const howToFile = getLocalizedFilename('howTo', 'html');
                const response = await fetch(`files/${howToFile}`);
                
                if (response.ok) {
                    const content = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(content, 'text/html');
                    
                    const h2Element = doc.querySelector('h2');
                    if (h2Element) {
                        defaultTitle = h2Element.textContent;
                        infoTitle.textContent = defaultTitle;
                        h2Element.remove();
                    }
                    
                    defaultText = doc.body.innerHTML;
                    infoText.innerHTML = defaultText;
                    infoText.style.display = 'block';
                } else {
                    // Fallback-Texte je nach Sprache
                    setFallbackContent();
                }
                
                // Standard-Bild mit Sprachsuffix
                const standardImage = getLocalizedFilename('standard', 'jpg');
                if (await fileExists(`files/${standardImage}`)) {
                    defaultImage = `files/${standardImage}`;
                    infoImage.src = defaultImage;
                } else {
                    // Fallback auf deutsches Standard-Bild
                    defaultImage = 'files/standard.jpg';
                    infoImage.src = defaultImage;
                }
                
            } catch (error) {
                console.error('Fehler beim Laden der Standard-Inhalte:', error);
                setFallbackContent();
            }
        }
        
        
        // HTML-Datei laden (erweitert für Mehrsprachigkeit)
        async function loadHtmlFile(number) {
            try {
                const htmlFile = getLocalizedFilename(number, 'html');
                let response = await fetch(`files/${htmlFile}`);
                
                if (!response.ok) {
                    const htmlFileUpper = getLocalizedFilename(number, 'HTML');
                    response = await fetch(`files/${htmlFileUpper}`);
                }
                
                if (response.ok) {
                    const content = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(content, 'text/html');
                    
                    const h2Element = doc.querySelector('h2');
                    let title = null;
                    if (h2Element) {
                        title = h2Element.textContent;
                        h2Element.remove();
                    }
                    
                    const htmlContent = doc.body.innerHTML;
                    
                    return {
                        title: title,
                        content: htmlContent
                    };
                }
            } catch (error) {
                console.log('HTML-Datei nicht gefunden:', error);
            }
            return null;
        }
        
        // Bild mit verschiedenen Formaten und Sprachen suchen
        async function findImage(number) {
            for (const ext of imageExtensions) {
                // Erst mit Sprachsuffix versuchen
                const localizedUrl = `files/${getLocalizedFilename(number, ext)}`;
                if (await fileExists(localizedUrl)) {
                    return localizedUrl;
                }
                
                const localizedUrlUpper = `files/${getLocalizedFilename(number, ext.toUpperCase())}`;
                if (await fileExists(localizedUrlUpper)) {
                    return localizedUrlUpper;
                }
                
                // Fallback auf deutsche Version
                if (currentLanguage !== 'de') {
                    const url = `files/${number}.${ext}`;
                    if (await fileExists(url)) {
                        return url;
                    }
                    const urlUpper = `files/${number}.${ext.toUpperCase()}`;
                    if (await fileExists(urlUpper)) {
                        return urlUpper;
                    }
                }
            }
            return null;
        }
        
        // Play Button Funktion (erweitert für Mehrsprachigkeit)
        async function playNumber() {
            const number = numberInput.value;
            if (!number) {
                console.log('Bitte geben Sie eine Nummer ein!');
                return;
            }
            
            const paddedNumber = number.padStart(3, '0');
            
            try {
                // Audio mit Sprachsuffix suchen
                let audioUrl = `./files/${getLocalizedFilename(paddedNumber, 'mp3')}`;
                let audioExists = await fileExists(audioUrl);
                
                if (!audioExists) {
                    audioUrl = `./files/${getLocalizedFilename(paddedNumber, 'MP3')}`;
                    audioExists = await fileExists(audioUrl);
                }
                
                // Fallback auf deutsche Version
                if (!audioExists && currentLanguage !== 'de') {
                    audioUrl = `./files/${paddedNumber}.mp3`;
                    audioExists = await fileExists(audioUrl);
                    
                    if (!audioExists) {
                        audioUrl = `./files/${paddedNumber}.MP3`;
                        audioExists = await fileExists(audioUrl);
                    }
                }
                
                if (audioExists) {
                    currentAudioUrl = audioUrl;
                    audioPlayer.src = audioUrl;
                    audioPlayer.style.display = 'block';
                    introAudio.style.display = 'none';
                    
                    try {
                        await audioPlayer.play();
                        isPlaying = true;
                        
                        playStopButton.textContent = '⏹';
                        playStopButton.className = 'numpad-key stop';
                        
                        console.log(`Spiele Nummer ${paddedNumber} ab`);
                    } catch (playError) {
                        console.error('Fehler beim Abspielen:', playError);
                        return;
                    }
                    
                    const imageUrl = await findImage(paddedNumber);
                    if (imageUrl) {
                        infoImage.src = imageUrl;
                        infoImage.alt = `Bild für Nummer ${paddedNumber}`;
                    } else {
                        infoImage.src = 'files/sound.svg';
                        infoImage.alt = `Audio-Symbol für Nummer ${paddedNumber}`;
                        console.log(`Kein Bild für Nummer ${paddedNumber} gefunden, verwende sound.svg`);
                    }
                    
                    const htmlData = await loadHtmlFile(paddedNumber);
                    if (htmlData) {
                        if (htmlData.title) {
                            infoTitle.textContent = htmlData.title;
                        } else {
                            infoTitle.textContent = `Nummer ${paddedNumber}`;
                        }
                        
                        infoText.innerHTML = htmlData.content;
                        infoText.style.display = 'block';
                    } else {
                        infoText.innerHTML = '';
                        infoText.style.display = 'none';
                        infoTitle.textContent = `Nummer ${paddedNumber}`;
                        console.log(`Keine HTML-Datei für Nummer ${paddedNumber} gefunden`);
                    }
                    
                } else {
                    console.log(`Keine Audio-Datei für Nummer ${paddedNumber} gefunden`);
                    
                    // Nosound SVG und HTML in entsprechender Sprache
                    const nosoundSvg = getLocalizedFilename('nosound', 'svg');
                    if (await fileExists(`files/${nosoundSvg}`)) {
                        infoImage.src = `files/${nosoundSvg}`;
                    } else {
                        infoImage.src = 'files/nosound.svg';
                    }
                    infoImage.alt = `Keine Audio-Datei für Nummer ${paddedNumber}`;
                    
                    const nosoundData = await loadHtmlFile('nosound');
                    if (nosoundData) {
                        if (nosoundData.title) {
                            infoTitle.textContent = nosoundData.title;
                        } else {
                            const noAudioTexts = {
                                'de': `Nummer ${paddedNumber} - Keine Audiodatei`,
                                'en': `Number ${paddedNumber} - No audio file`,
                                'zh': `编号 ${paddedNumber} - 没有音频文件`
                            };
                            infoTitle.textContent = noAudioTexts[currentLanguage] || noAudioTexts['de'];
                        }
                        infoText.innerHTML = nosoundData.content;
                        infoText.style.display = 'block';
                    } else {
                        const noAudioTexts = {
                            'de': {
                                title: `Nummer ${paddedNumber} - Keine Audiodatei`,
                                content: '<p>Für diese Nummer ist keine Audiodatei verfügbar.</p>'
                            },
                            'en': {
                                title: `Number ${paddedNumber} - No audio file`,
                                content: '<p>No audio file is available for this number.</p>'
                            },
                            'zh': {
                                title: `编号 ${paddedNumber} - 没有音频文件`,
                                content: '<p>此编号没有可用的音频文件。</p>'
                            }
                        };
                        
                        const content = noAudioTexts[currentLanguage] || noAudioTexts['de'];
                        infoTitle.textContent = content.title;
                        infoText.innerHTML = content.content;
                        infoText.style.display = 'block';
                    }
                }
                
                backButton.style.display = 'block';
                
            } catch (error) {
                console.error('Fehler beim Laden der Dateien:', error);
            }
            
            setTimeout(() => {
                numberInput.value = '';
            }, 1000);
        }
        
        // Audio stoppen und zurücksetzen
        function stopAudio() {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            audioPlayer.style.display = 'none';
            introAudio.style.display = 'block';
            isPlaying = false;
            
            playStopButton.textContent = '▶';
            playStopButton.className = 'numpad-key play';
            
            resetToDefault();
            
            console.log('Wiedergabe gestoppt');
        }
        
        // Audio-Player Event Listener
        audioPlayer.addEventListener('ended', function() {
            isPlaying = false;
            playStopButton.textContent = '▶';
            playStopButton.className = 'numpad-key play';
            console.log('Wiedergabe beendet');
        });
        
        audioPlayer.addEventListener('error', function() {
            isPlaying = false;
            playStopButton.textContent = '▶';
            playStopButton.className = 'numpad-key play';
            console.error('Fehler beim Laden der Audio-Datei');
        });
        
        // Beim Laden der Seite (erweitert)
        document.addEventListener('DOMContentLoaded', function() {
            // Standard auf Deutsch setzen
            setLanguage('de');
            numberInput.focus();
        });
        
        // Zurück zum Standard-Content
        function resetToDefault() {
            infoTitle.textContent = defaultTitle;
            infoImage.src = defaultImage;
            infoText.innerHTML = defaultText;
            infoText.style.display = 'block';
            audioPlayer.style.display = 'none';
            introAudio.style.display = 'block';
            backButton.style.display = 'none';
            
            if (isPlaying) {
                audioPlayer.pause();
                isPlaying = false;
                playStopButton.textContent = '▶';
                playStopButton.className = 'numpad-key play';
            }
        }
        
        // Zahl eingeben (auf 3 Zeichen begrenzt)
        function inputNumber(digit) {
            const currentValue = numberInput.value;
            
            if (currentValue.length < 3) {
                numberInput.value = currentValue + digit;
                numberInput.dispatchEvent(new Event('input', { bubbles: true }));
            }
        }
        
        // Letzte Ziffer löschen
        function backspace() {
            const currentValue = numberInput.value;
            numberInput.value = currentValue.slice(0, -1);
            numberInput.dispatchEvent(new Event('input', { bubbles: true }));
        }
        
        // Datei existiert prüfen
        async function fileExists(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                return response.ok;
            } catch (error) {
                return false;
            }
        }
        
        // Play/Stop Toggle Funktion
        function togglePlayStop() {
            if (isPlaying) {
                stopAudio();
            } else {
                playNumber();
            }
        }
    </script>
</body>
</html>